function genGcode(){var a=parseFloat(document.getElementById("FIL_DIA").value),d=parseFloat(document.getElementById("NOZ_DIA").value),c=parseInt(document.getElementById("NOZZLE_TEMP").value),b=parseFloat(document.getElementById("NOZ_LIN_R").value),f=parseInt(document.getElementById("BED_TEMP").value),l=parseInt(document.getElementById("SLOW_SPEED").value),e=parseInt(document.getElementById("FAST_SPEED").value),g=parseInt(document.getElementById("MOVE_SPEED").value),k=parseInt(document.getElementById("PRINT_ACCL").value),
n=parseFloat(document.getElementById("RETRACTION").value),p=document.getElementById("SHAPE_BED"),x=p.options[p.selectedIndex].value;p=parseInt(document.getElementById("BEDSIZE_X").value);var z=parseInt(document.getElementById("BEDSIZE_Y").value),A=document.getElementById("CENTER_NULL").checked,y=parseFloat(document.getElementById("LAYER_HEIGHT").value),K=parseFloat(document.getElementById("EXTRUSION_MULT").value),q=document.getElementById("LIN_VERSION"),L=q.options[q.selectedIndex].value;q=document.getElementById("TYPE_PATTERN");
var C=q.options[q.selectedIndex].value,D=parseFloat(document.getElementById("K_START").value);q=parseFloat(document.getElementById("K_END").value);var M=parseFloat(document.getElementById("K_STEP").value),N=parseFloat(document.getElementById("X_JERK").value),O=parseFloat(document.getElementById("Y_JERK").value),P=parseFloat(document.getElementById("Z_JERK").value),Q=parseFloat(document.getElementById("E_JERK").value),v=document.getElementById("DIR_PRINT"),R=v.options[v.selectedIndex].value;v=parseFloat(document.getElementById("SPACE_LINE").value);
var E=document.getElementById("FRAME").checked,u=document.getElementById("PRIME").checked,V=document.getElementById("USE_BL").checked,m=document.getElementById("MM_S").checked,W=parseFloat(document.getElementById("PRIME_EXT").value),S=parseFloat(document.getElementById("DWELL_PRIME").value),w=parseFloat(document.getElementById("SLOW_LENGTH").value),r=parseFloat(document.getElementById("FAST_LENGTH").value),H=parseFloat(document.getElementById("OFFSET_Z").value),B=document.getElementById("LINE_NO").checked;
"Round"===x&&(z=p);m&&(l*=60,e*=60,g*=60);var t=(q-D)/M*v+25;m=2*w+r+(u?10:0)+(B?8:0);var I=A?0:p/2,T=A?0:z/2,F=I-.5*r-w+(u?5:0)-(B?4:0),U=T-t/2,G=d*b,h=G*y/(Math.pow(a/2,2)*Math.PI),J=R*Math.PI/180,X=Math.abs(m*Math.cos(J))+Math.abs(t*Math.sin(J)),Y=Math.abs(m*Math.sin(J))+Math.abs(t*Math.cos(J));m=document.getElementById("textarea");h={slow:l,fast:e,move:g,centerX:I,centerY:T,printDir:R,lineWidth:G,extRatio:h,extMult:K,extMultPrime:W,retractDist:n};J={lengthSlow:w,lengthFast:r,kStart:D,kEnd:q,kStep:M,
lineSpacing:v};m.value="";m.value="; ### Marlin K-Factor Calibration Pattern ###\n; -------------------------------------------\n;\n; Created: "+new Date+"\n;\n; Settings Printer:\n; Filament Diameter = "+a+" mm\n; Nozzle Diameter = "+d+" mm\n; Nozzle Temperature = "+c+" \u00b0C\n; Bed Temperature = "+f+" \u00b0C\n; Retraction Distance = "+n+" mm\n; Layer Height = "+y+" mm\n; Z-axis Offset = "+H+" mm\n;\n; Settings Print Bed:\n; Bed Shape = "+x+"\n"+("Round"===x?"; Bed Diameter = "+p+" mm\n":"; Bed Size X = "+
p+" mm\n")+("Round"===x?"":"; Bed Size Y = "+z+" mm\n")+"; Origin Bed Center = "+(A?"true":"false")+"\n;\n; Settings Speed:\n; Slow Printing Speed = "+l+" mm/min\n; Fast Printing Speed = "+e+" mm/min\n; Movement Speed = "+g+" mm/min\n; Printing Acceleration = "+k+" mm/s^2\n; Jerk X-axis = "+(-1!==N?N+"\n":" firmware default\n")+"; Jerk Y-axis = "+(-1!==O?O+"\n":" firmware default\n")+"; Jerk Z-axis = "+(-1!==P?P+"\n":" firmware default\n")+"; Jerk Extruder = "+(-1!==Q?Q+"\n":" firmware default\n")+
";\n; Settings Pattern:\n; Linear Advance Version = "+L+"\n; Starting Value Factor = "+D+"\n; Ending Value Factor = "+q+"\n; Factor Stepping = "+M+"\n; Test Line Spacing = "+v+" mm\n; Test Line Length Slow = "+w+" mm\n; Test Line Length Fast = "+r+" mm\n; Print Pattern = "+("alt"===C?"Alternate":"Standard")+"\n; Print Frame = "+(E?"true":"false")+"\n; Number Lines = "+(B?"true":"false")+"\n; Print Size X = "+X+" mm\n; Print Size Y = "+Y+" mm\n; Print Rotation = "+R+" degree\n;\n; Settings Advance:\n; Nozzle / Line Ratio = "+
b+"\n; Use BL = "+(V?"true":"false")+"\n; Extrusion Multiplier = "+K+"\n; Prime Nozzle = "+(u?"true":"false")+"\n; Prime Extrusion Multiplier = "+W+"\n; Dwell Time = "+S+" s\n;\n; prepare printing\n;\nG28 ; home all axes\nM190 S"+f+" ; set and wait for bed temp\nM104 S"+c+" ; set nozzle temp and continue\n"+(V?"G29 ; execute bed automatic leveling compensation\n":"")+"M109 S"+c+" ; block waiting for nozzle temp\nG21 ; set units to millimeters\nM204 P"+k+" ; set acceleration\n"+(-1!==N?"M205 X"+N+
" ; set X jerk\n":"")+(-1!==O?"M205 Y"+O+" ; set Y jerk\n":"")+(-1!==P?"M205 Z"+P+" ; set Z jerk\n":"")+(-1!==Q?"M205 E"+Q+" ; set E jerk\n":"")+"G90 ; use absolute coordinates\nM83 ; use relative distances for extrusion\nG92 E0 ; reset extruder distance\n";m.value+=moveTo(I,T,h)+"G1 Z"+(y+H)+" F"+l+" ; move to layer height\n";u&&(a=I-w-.5*r-(B?4:0)-5,d=T-t/2,m.value+=";\n; prime nozzle\n;\n"+moveTo(a,d,h)+createLine(a,d+t,t,h,{prime:!0})+moveTo(a+1.5*G,d+t,h)+createLine(a+1.5*G,d,-t,h,{prime:!0})+
doEfeed("-",h));E&&(a=F+2*w+r,d=U-3,c=t-19,m.value+=";\n; print anchor frame\n;\n"+moveTo(F-G,d,h)+(u?doEfeed("+",h):"")+createLine(F-G,d+c,c,h)+moveTo(F,d+c,h)+createLine(F,d,-c,h)+doEfeed("-",h)+moveTo(a,d,h)+doEfeed("+",h)+createLine(a,d+c,c,h)+moveTo(a+G,d+c,h)+createLine(a+G,d,-c,h)+doEfeed("-",h));u||E||(m.value+=doEfeed("-",h));m.value+=";\n; start the Test pattern\n;\n"+(S?"G4 P"+1E3*S+" ; Pause (dwell) for 2 seconds\n":"")+moveTo(F,U,h);"std"===C?m.value+=createStdPattern(F,U,h,J):"alt"===
C&&(m.value+=createAltPattern(F,U,h,J));C=I-.5*r+(u?5:0)-(B?4:0);E=I+.5*r+(u?5:0)-(B?4:0);t=T+t/2-20;m.value+=";\n; mark the test area for reference\n;\nM900 K0 ; set K-factor 0\n"+moveTo(C,t,h)+doEfeed("+",h)+createLine(C,t+20,20,h)+doEfeed("-",h)+moveTo(E,t,h)+doEfeed("+",h)+createLine(E,t+20,20,h)+doEfeed("-",h)+zHop(y+H+.1,h);if(B)for(u=I+.5*r+w+(u?5:0)-2,w=U-2,r=0;D<=q;D+=M)0===r%2&&(m.value+=";\n; print K-values\n;\n"+moveTo(u,w+r*v,h)+zHop(y+H,h)+doEfeed("+",h)+createGlyphs(u,w+r*v,h,Math.round10(D,
-3))+doEfeed("-",h)+zHop(y+H+.1,h)),r+=1;m.value+=";\n; finish\n;\nM104 S0 ; turn off hotend\nM140 S0 ; turn off bed\nG1 Z30 X"+(A?p/2:p)+" Y"+(A?z/2:z)+" F"+g+" ; move away from the print\nM84 ; disable motors\nM502 ; resets parameters from ROM\nM501 ; resets parameters from EEPROM\n;"}function saveTextAsFile(){var a=document.getElementById("textarea").value,d=new Blob([a],{type:"text/plain"});a?saveAs(d,"kfactor.gcode"):alert("Generate G-code first")}
(function(){function a(d,c,b){if("undefined"===typeof b||0===Number(b))return Math[d](c);c=Number(c);b=Number(b);if(null===c||isNaN(c)||"number"!==typeof b||0!==b%1)return NaN;if(0>c)return-a(d,-c,b);c=c.toString().split("e");c=Math[d](Number(c[0]+"e"+(c[1]?Number(c[1])-b:-b)));c=c.toString().split("e");return Number(c[0]+"e"+(c[1]?Number(c[1])+b:b))}Math.round10||(Math.round10=function(d,c){return a("round",d,c)});Math.floor10||(Math.floor10=function(d,c){return a("floor",d,c)});Math.ceil10||(Math.ceil10=
function(d,c){return a("ceil",d,c)})})();function getDecimals(a){var d=String(a).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/);return d?Math.max(0,(d[1]?d[1].length:0)-(d[2]?Number(d[2]):0)):a}
function createLine(a,d,c,b,f){var l="";f=$.extend({},{speed:"slow",prime:"false",comment:" ; print line\n"},f);c=!0===f.prime?Math.round10(b.extRatio*b.extMultPrime*Math.abs(c),-4):Math.round10(b.extRatio*b.extMult*Math.abs(c),-4);return l+="G1 X"+Math.round10(rotateX(a,b.centerX,d,b.centerY,b.printDir),-4)+" Y"+Math.round10(rotateY(a,b.centerX,d,b.centerY,b.printDir),-4)+" E"+c+" F"+b[f.speed]+f.comment}
function moveTo(a,d,c){return"G1 X"+Math.round10(rotateX(a,c.centerX,d,c.centerY,c.printDir),-4)+" Y"+Math.round10(rotateY(a,c.centerX,d,c.centerY,c.printDir),-4)+" F"+c.move+" ; move to start\n"}function doEfeed(a,d){var c="";"+"===a?c+="G1 E"+d.retractDist+" ; un-retract\n":"-"===a&&(c+="G1 E-"+d.retractDist+" ; retract\n");return c}
function createAltPattern(a,d,c,b){var f=0,l=0;var e=""+doEfeed("+",c);for(var g=b.kStart;g<=b.kEnd;g+=b.kStep)0===l%2?(e+="M900 K"+Math.round10(g,-2)+" ; set K-factor\n"+createLine(a+b.lengthSlow,d+f,b.lengthSlow,c,{speed:"slow"})+createLine(a+b.lengthSlow+b.lengthFast,d+f,b.lengthFast,c,{speed:"fast"})+createLine(a+2*b.lengthSlow+b.lengthFast,d+f,b.lengthSlow,c,{speed:"slow"})+createLine(a+2*b.lengthSlow+b.lengthFast,d+f+b.lineSpacing,b.lineSpacing,c,{speed:"fast"}),f+=b.lineSpacing,l+=1):0!==l%
2&&(e+="M900 K"+Math.round10(g,-2)+" ; set K-factor\n"+createLine(a+b.lengthSlow+b.lengthFast,d+f,b.lengthSlow,c,{speed:"slow"})+createLine(a+b.lengthSlow,d+f,b.lengthFast,c,{speed:"fast"})+createLine(a,d+f,b.lengthSlow,c,{speed:"slow"})+createLine(a,d+f+b.lineSpacing,b.lineSpacing,c,{speed:"fast"}),f+=b.lineSpacing,l+=1);return e+=doEfeed("-",c)}
function createStdPattern(a,d,c,b){for(var f=0,l="",e=b.kStart;e<=b.kEnd;e+=b.kStep)l+="M900 K"+Math.round10(e,-2)+" ; set K-factor\n"+doEfeed("+",c)+createLine(a+b.lengthSlow,d+f,b.lengthSlow,c,{speed:"slow"})+createLine(a+b.lengthSlow+b.lengthFast,d+f,b.lengthFast,c,{speed:"fast"})+createLine(a+2*b.lengthSlow+b.lengthFast,d+f,b.lengthSlow,c,{speed:"slow"})+doEfeed("-",c)+(e!==b.kEnd?moveTo(a,d+f+b.lineSpacing,c):""),f+=b.lineSpacing;return l}
function createGlyphs(a,d,c,b){var f="",l=0,e=0;b=b.toString();for(var g={1:["up","up"],2:"mup mup right down left down right".split(" "),3:"mup mup right down down left mup right".split(" "),4:"mup mup down right mup down down".split(" "),5:["right","up","left","up","right"],6:"mup right down left up up right".split(" "),7:["mup","mup","right","down","down"],8:"mup right down left up up right down".split(" "),9:"right up left up right down".split(" "),0:"right up up left down down".split(" "),".":["dot"]},
k=0,n=b.length;k<n;k+=1){for(var p in g[b.charAt(k)])if(g[b.charAt(k)].hasOwnProperty(p)){var x=createLine(a+2*l,d+2*e+2,2,c,{speed:"slow",comment:" ; "+b.charAt(k)+"\n"}),z=createLine(a+2*l,d+2*e-2,2,c,{speed:"slow",comment:" ; "+b.charAt(k)+"\n"}),A=createLine(a+2*l+2,d+2*e,2,c,{speed:"slow",comment:" ; "+b.charAt(k)+"\n"}),y=createLine(a+2*l-2,d+2*e,2,c,{speed:"slow",comment:" ; "+b.charAt(k)+"\n"}),K=moveTo(a+2*l,d+2*e+2,c),q=createLine(a,d+.4,.4,c,{speed:"slow",comment:" ; dot\n"});"up"===g[b.charAt(k)][p]?
(f+=x,e+=1):"down"===g[b.charAt(k)][p]?(f+=z,--e):"right"===g[b.charAt(k)][p]?(f+=A,l+=1):"left"===g[b.charAt(k)][p]?(f+=y,--l):"mup"===g[b.charAt(k)][p]?(f+=K,e+=1):"dot"===g[b.charAt(k)][p]&&(f+=q)}a="1"===b.charAt(k)||"."===b.charAt(k)?a+1:a+3;k!==b.length-1&&(f+=doEfeed("-",c)+moveTo(a,d,c)+doEfeed("+",c));l=e=0}return f}function zHop(a,d){return"G1 Z"+Math.round10(a,-3)+" F"+d.slow+" ; zHop\n"}function rotateX(a,d,c,b,f){f=f*Math.PI/180;return Math.cos(f)*(a-d)+Math.sin(f)*(c-b)+d}
function rotateY(a,d,c,b,f){f=f*Math.PI/180;return Math.cos(f)*(c-b)-Math.sin(f)*(a-d)+b}
function setLocalStorage(){var a=parseFloat(document.getElementById("FIL_DIA").value),d=parseFloat(document.getElementById("NOZ_DIA").value),c=parseInt(document.getElementById("NOZZLE_TEMP").value),b=parseFloat(document.getElementById("NOZ_LIN_R").value),f=parseInt(document.getElementById("BED_TEMP").value),l=parseInt(document.getElementById("SLOW_SPEED").value),e=parseInt(document.getElementById("FAST_SPEED").value),g=parseInt(document.getElementById("MOVE_SPEED").value),k=parseInt(document.getElementById("PRINT_ACCL").value),
n=parseFloat(document.getElementById("RETRACTION").value),p=document.getElementById("SHAPE_BED");p=p.options[p.selectedIndex].value;var x=parseInt(document.getElementById("BEDSIZE_X").value),z=parseInt(document.getElementById("BEDSIZE_Y").value),A=document.getElementById("CENTER_NULL").checked,y=parseFloat(document.getElementById("LAYER_HEIGHT").value),K=parseFloat(document.getElementById("EXTRUSION_MULT").value),q=document.getElementById("LIN_VERSION");q=q.options[q.selectedIndex].value;var L=document.getElementById("TYPE_PATTERN");
L=L.options[L.selectedIndex].value;var C=parseFloat(document.getElementById("K_START").value),D=parseFloat(document.getElementById("K_END").value),M=parseFloat(document.getElementById("K_STEP").value),N=parseFloat(document.getElementById("X_JERK").value),O=parseFloat(document.getElementById("Y_JERK").value),P=parseFloat(document.getElementById("Z_JERK").value),Q=parseFloat(document.getElementById("E_JERK").value),v=document.getElementById("DIR_PRINT");v=v.options[v.selectedIndex].value;var R=parseFloat(document.getElementById("SPACE_LINE").value),
E=document.getElementById("FRAME").checked,u=document.getElementById("PRIME").checked,V=parseFloat(document.getElementById("PRIME_EXT").value),m=parseFloat(document.getElementById("DWELL_PRIME").value),W=parseFloat(document.getElementById("SLOW_LENGTH").value),S=parseFloat(document.getElementById("FAST_LENGTH").value),w=parseFloat(document.getElementById("OFFSET_Z").value),r=document.getElementById("USE_BL").checked,H=document.getElementById("MM_S").checked,B=document.getElementById("LINE_NO").checked;
a=JSON.stringify({FILAMENT_DIAMETER:a,NOZZLE_DIAMETER:d,NOZZLE_TEMP:c,NOZZLE_LINE_RATIO:b,BED_TEMP:f,SPEED_SLOW:l,SPEED_FAST:e,SPEED_MOVE:g,ACCELERATION:k,RETRACT_DIST:n,BED_SHAPE:p,BED_X:x,BED_Y:z,NULL_CENTER:A,HEIGHT_LAYER:y,EXT_MULT:K,VERSION_LIN:q,PATTERN_TYPE:L,START_K:C,END_K:D,STEP_K:M,JERK_X:N,JERK_Y:O,JERK_Z:P,JERK_E:Q,PRINT_DIR:v,LINE_SPACING:R,USE_FRAME:E,USE_PRIME:u,EXT_MULT_PRIME:V,PRIME_DWELL:m,LENGTH_SLOW:W,LENGTH_FAST:S,Z_OFFSET:w,USE_BL:r,USE_MMS:H,USE_LINENO:B});window.localStorage.setItem("LIN_SETTINGS",
a)}
$(window).load(function(){var a=$(".txtareatd").height();$(".calibpat textarea").css({height:a+"px"});$(":input:not(:hidden)").each(function(a){$(this).attr("tabindex",a+1)});window.localStorage.getItem("LIN_SETTINGS")&&(a=unescape(window.localStorage.getItem("LIN_SETTINGS")),a=jQuery.parseJSON(a),$("#FIL_DIA").val(a.FILAMENT_DIAMETER),$("#NOZ_DIA").val(a.NOZZLE_DIAMETER),$("#NOZZLE_TEMP").val(a.NOZZLE_TEMP),$("#NOZ_LIN_R").val(a.NOZZLE_LINE_RATIO),$("#BED_TEMP").val(a.BED_TEMP),$("#SLOW_SPEED").val(a.SPEED_SLOW),$("#FAST_SPEED").val(a.SPEED_FAST),
$("#MOVE_SPEED").val(a.SPEED_MOVE),$("#PRINT_ACCL").val(a.ACCELERATION),$("#RETRACTION").val(a.RETRACT_DIST),$("#SHAPE_BED").val(a.BED_SHAPE),$("#BEDSIZE_X").val(a.BED_X),$("#BEDSIZE_Y").val(a.BED_Y),$("#CENTER_NULL").prop("checked",a.NULL_CENTER),$("#LAYER_HEIGHT").val(a.HEIGHT_LAYER),$("#EXTRUSION_MULT").val(a.EXT_MULT),$("#LIN_VERSION").val(a.VERSION_LIN),$("#TYPE_PATTERN").val(a.PATTERN_TYPE),$("#K_START").val(a.START_K),$("#K_END").val(a.END_K),$("#K_STEP").val(a.STEP_K),$("#X_JERK").val(a.JERK_X),
$("#Y_JERK").val(a.JERK_Y),$("#Z_JERK").val(a.JERK_Z),$("#E_JERK").val(a.JERK_E),$("#DIR_PRINT").val(a.PRINT_DIR),$("#SPACE_LINE").val(a.LINE_SPACING),$("#FRAME").prop("checked",a.USE_FRAME),$("#PRIME").prop("checked",a.USE_PRIME),$("#PRIME_EXT").val(a.EXT_MULT_PRIME),$("#DWELL_PRIME").val(a.PRIME_DWELL),$("#SLOW_LENGTH").val(a.LENGTH_SLOW),$("#FAST_LENGTH").val(a.LENGTH_FAST),$("#OFFSET_Z").val(a.Z_OFFSET),$("#USE_BL").prop("checked",a.USE_BL),$("#MM_S").prop("checked",a.USE_MMS),$("#LINE_NO").prop("checked",
a.USE_LINENO),toggleBedShape(),patternType(),togglePrime(),toggleVersion());$("#MM_S").change(function(){speedToggle()});$("#SHAPE_BED").change(function(){toggleBedShape();validateInput()});$("#PRIME").change(function(){togglePrime()});$("#TYPE_PATTERN").change(function(){patternType()});$("#LIN_VERSION").change(function(){toggleVersion();validateInput()})});
function speedToggle(){$("#SLOW_SPEED").val();$("#FAST_SPEED").val();$("#MOVE_SPEED").val();if($("#MM_S").is(":checked")){var a=$("#SLOW_SPEED").val();var d=$("#FAST_SPEED").val();var c=$("#MOVE_SPEED").val();$("#SLOW_SPEED").val(a/60);$("#FAST_SPEED").val(d/60);$("#MOVE_SPEED").val(c/60)}else a=$("#SLOW_SPEED").val(),d=$("#FAST_SPEED").val(),c=$("#MOVE_SPEED").val(),$("#SLOW_SPEED").val(60*a),$("#FAST_SPEED").val(60*d),$("#MOVE_SPEED").val(60*c)}
function toggleBedShape(){"Round"===$("#SHAPE_BED").val()?($("label[for='BEDSIZE_X']").text("Bed Diameter:"),$("#shape").text("Diameter (mm) of the bed"),$("#BEDSIZE_Y").prop("disabled",!0),$("label[for=BEDSIZE_Y]").css({opacity:.5}),$("#CENTER_NULL").is(":checked")||$("#CENTER_NULL").prop("checked",!$("#CENTER_NULL").prop("checked"))):($("label[for='BEDSIZE_X']").text("Bed Size X:"),$("#shape").text("Size (mm) of the bed in X"),$("#BEDSIZE_Y").prop("disabled",!1),$("label[for=BEDSIZE_Y]").css({opacity:1}))}
function patternType(){"alt"===$("#TYPE_PATTERN").val()?($("#FRAME").is(":checked")&&$("#FRAME").prop("checked",!1),$("#FRAME").prop("disabled",!0),$("label[for=FRAME]").css({opacity:.5})):"std"===$("#TYPE_PATTERN").val()&&($("#FRAME").prop("disabled",!1),$("label[for=FRAME]").css({opacity:1}))}
function togglePrime(){$("#PRIME").is(":checked")?($("#PRIME_EXT").prop("disabled",!1),$("label[for=PRIME_EXT]").css({opacity:1})):($("#PRIME_EXT").prop("disabled",!0),$("label[for=PRIME_EXT]").css({opacity:.5}))}
function toggleVersion(){"1.5"===$("#LIN_VERSION").val()?($("#K_START").attr("step","any"),$("#K_END").attr("step","any"),$("#K_STEP").attr("step","any"),$("#K_START").val("0"),$("#K_END").val("2"),$("#K_STEP").val("0.2"),$("#start_factor").text("Starting value for the K-factor. Usually 0 but for bowden setups you might want to start higher, e.g. 2"),$("#end_factor").text("Ending value of the K-factor. Bowden setups may be higher than 2")):($("#K_START").attr("step","1"),$("#K_END").attr("step","1"),
$("#K_STEP").attr("step","1"),$("#K_STEP").attr("value","5"),$("#K_START").val("0"),$("#K_END").val("100"),$("#K_STEP").val("5"),$("#start_factor").text("Starting value for the K-factor. Usually 0 but for bowden setups you might want to start higher, e.g. 30"),$("#end_factor").text("Ending value of the K-factor. Bowden setups may be higher than 100"));$("#step_factor").text("Stepping of the K-factor in the test pattern. Needs to be an exact divisor of the K-factor Range (End - Start)")}
function validateInput(){var a=document.getElementById("SHAPE_BED");a=a.options[a.selectedIndex].value;var d=parseInt(document.getElementById("BEDSIZE_X").value),c=parseInt(document.getElementById("BEDSIZE_Y").value),b=parseFloat(document.getElementById("K_START").value),f=parseFloat(document.getElementById("K_END").value),l=parseFloat(document.getElementById("K_STEP").value),e=document.getElementById("DIR_PRINT"),g=e.options[e.selectedIndex].value;e=parseFloat(document.getElementById("SPACE_LINE").value);
var k=document.getElementById("PRIME").checked,n=parseFloat(document.getElementById("SLOW_LENGTH").value),p=parseFloat(document.getElementById("FAST_LENGTH").value),x=document.getElementById("LINE_NO").checked;e=(f-b)/l*e+25;k=2*n+p+(k?10:0)+(x?8:0);n=g*Math.PI/180;g=Math.round10(Math.abs(k*Math.cos(n))+Math.abs(e*Math.sin(n)),0);e=Math.round10(Math.abs(k*Math.sin(n))+Math.abs(e*Math.cos(n)),0);k=getDecimals(l);n=0;$("#K_START, #K_END, #K_STEP, #SPACE_LINE, #SLOW_LENGTH, #FAST_LENGTH").each(function(){$(this)[0].setCustomValidity("");
$("label[for="+$(this).attr("id")+"]").removeClass("calibpat_invalidSize");$("label[for="+$(this).attr("id")+"]").removeClass("calibpat_invalidDiv")});$("#warning1").hide();$("#warning2").hide();0!==(f-b)*Math.pow(10,k)%(l*Math.pow(10,k))&&($("label[for=K_START]").addClass("calibpat_invalidDiv"),$("#K_START")[0].setCustomValidity("Your K-Factor range cannot be cleanly divided."),$("label[for=K_END]").addClass("calibpat_invalidDiv"),$("#K_END")[0].setCustomValidity("Your K-Factor range cannot be cleanly divided."),
$("label[for=K_STEP]").addClass("calibpat_invalidDiv"),$("#K_STEP")[0].setCustomValidity("Your K-Factor range cannot be cleanly divided."),$("#warning1").text("Your K-Factor range cannot be cleanly divided. Check highlighted Pattern Settings."),$("#warning1").addClass("calibpat_invalidDiv"),$("#warning1").show(),n=1);"Round"===a&&Math.sqrt(Math.pow(g,2)+Math.pow(e,2))>d-5&&e>g&&($("label[for=K_START]").addClass("calibpat_invalidSize"),$("#K_START")[0].setCustomValidity("Your Pattern size (x: "+g+
", y: "+e+") exceeds your bed's diameter."),$("label[for=K_END]").addClass("calibpat_invalidSize"),$("#K_END")[0].setCustomValidity("Your Pattern size (x: "+g+", y: "+e+") exceeds your bed's diameter."),$("label[for=K_STEP]").addClass("calibpat_invalidSize"),$("#K_STEP")[0].setCustomValidity("Your Pattern size (x: "+g+", y: "+e+") exceeds your bed's diameter."),$("label[for=SPACE_LINE]").addClass("calibpat_invalidSize"),$("#SPACE_LINE")[0].setCustomValidity("Your Pattern size (x: "+g+", y: "+e+") exceeds your bed's diameter."),
$(n?"#warning2":"#warning1").text("Your Pattern size (x: "+g+", y: "+e+") exceeds your bed's diameter. Check highlighted Pattern Settings."),$(n?"#warning2":"#warning1").addClass("calibpat_invalidSize"),$(n?"#warning2":"#warning1").show());"Round"===a&&Math.sqrt(Math.pow(g,2)+Math.pow(e,2))>d-5&&g>e&&($("label[for=SLOW_LENGTH]").addClass("calibpat_invalidSize"),$("#SLOW_LENGTH")[0].setCustomValidity("Your Pattern size (x: "+g+", y: "+e+") exceeds your bed's diameter."),$("label[for=FAST_LENGTH]").addClass("calibpat_invalidSize"),
$("#FAST_LENGTH")[0].setCustomValidity("Your Pattern size (x: "+g+", y: "+e+") exceeds your bed's diameter."),$(n?"#warning2":"#warning1").text("Your Pattern size (x: "+g+", y: "+e+") exceeds your bed's diameter. Check highlighted Pattern Settings."),$(n?"#warning2":"#warning1").addClass("calibpat_invalidSize"),$(n?"#warning2":"#warning1").show());"Rect"===a&&g>d-5&&($("label[for=SLOW_LENGTH]").addClass("calibpat_invalidSize"),$("#SLOW_LENGTH")[0].setCustomValidity("Your Pattern size (x: "+g+", y: "+
e+") exceeds your X bed size."),$("label[for=FAST_LENGTH]").addClass("calibpat_invalidSize"),$("#FAST_LENGTH")[0].setCustomValidity("Your Pattern size (x: "+g+", y: "+e+") exceeds your X bed size."),$(n?"#warning2":"#warning1").text("Your Pattern size (x: "+g+", y: "+e+") exceeds your X bed size. Check highlighted Pattern Settings."),$(n?"#warning2":"#warning1").addClass("calibpat_invalidSize"),$(n?"#warning2":"#warning1").show());"Rect"===a&&e>c-5&&($("label[for=K_START]").addClass("calibpat_invalidSize"),
$("#K_START")[0].setCustomValidity("Your Pattern size (x: "+g+", y: "+e+") exceeds your Y bed size."),$("label[for=K_END]").addClass("calibpat_invalidSize"),$("#K_END")[0].setCustomValidity("Your Pattern size (x: "+g+", y: "+e+") exceeds your Y bed size."),$("label[for=K_STEP]").addClass("calibpat_invalidSize"),$("#K_STEP")[0].setCustomValidity("Your Pattern size (x: "+g+", y: "+e+") exceeds your Y bed size."),$("label[for=SPACE_LINE]").addClass("calibpat_invalidSize"),$("#SPACE_LINE")[0].setCustomValidity("Your Pattern size (x: "+
g+", y: "+e+") exceeds your Y bed size."),$(n?"#warning2":"#warning1").text("Your Pattern size (x: "+g+", y: "+e+") exceeds your Y bed size. Check highlighted Pattern Settings."),$(n?"#warning2":"#warning1").addClass("calibpat_invalidSize"),$(n?"#warning2":"#warning1").show())};
